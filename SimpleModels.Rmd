---
title: "Simple Models"
author: "Daniel Hopkins & Rob Verbeek"
date: "12/1/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(rstan)
library(ggplot2)
library(corrplot)
library(rstanarm)
library(scatterplot3d)
library("bayesplot")
theme_set(bayesplot::theme_default(base_family = "sans"))
SEED = 1234 
```

## Reading in the ESS Data

```{r selecting data rows and variables}
# N = 1000 # Number of sample points

set.seed(1234)

M = length(ESSData$lrscale)
ESSData <- read.csv(file="data/filtered_data2.csv", header=TRUE, sep=",")
country = ESSData$cntry
age = 2016 - ESSData$yrbrn
age = age/max(age)
drops = c("cntry","yrbrn")
ESSData = ESSData[,!(names(ESSData) %in% drops)] / 10
ESSData = data.frame(age,ESSData)

small_sample_rows = sample(seq(1,M),5000)

test_rows = sample(seq(1,M),1000)

small_sample = data.frame(ESSData[small_sample_rows,])

training_data = data.frame(ESSData[-test_rows,])

test_data = data.frame(ESSData[test_rows,])
```



```{r}
fit_lm_1 <- stan_glm(lrscale ~ gincdif, data=small_sample)
print(fit_lm_1)
```

ADD HERE: TWO LINES DEPENDING ON COUNTRY
```{r, fig.height=5}
# ESSData$cntry
# colors <- ifelse(small_sample$country=="NL", "black", "gray")
plot(jitter(small_sample$gincdif,1), jitter(small_sample$lrscale,1), xlab="Government should reduce income differences", ylab="Political Alignment")
abline(coef(fit_lm_1))
```
```{r, fig.height=5}
ggplot(small_sample, aes(jitter(gincdif,1), jitter(lrscale,1))) +
  geom_point() +
  geom_abline(intercept = coef(fit_lm_1)[1], slope = coef(fit_lm_1)[2]) +
  labs(x = "Government should reduce income differences", y = "Political Alignment")
```
```{r}
fit_lm_2 <- stan_glm(lrscale ~ gincdif + sbbsntx, data=small_sample)
print(fit_lm_2)
summary(fit_lm_2)
```
```{r correlation matrix}
c = cor(data.frame(small_sample))
lr_cor = c["lrscale",]
top_variables = lr_cor[order(abs(lr_cor),decreasing=TRUE)][1:21]
best_columns = order(abs(lr_cor),decreasing=TRUE)[1:21]
smaller_sample = small_sample[best_columns]
top_variables
```



```{r}

fit_lm_3 <- stan_glm(lrscale ~ ., data=smaller_sample)
print(fit_lm_3)
summary(fit_lm_3)
```

```{r}
correct = 0
wrong = 0
error = 0
prediction = seq(1,1000)
w = fit_lm_3$coefficients

for(n in seq(1:1000)) {
  prediction[n] = (w[2:11] %*% as.numeric(smaller_sample[n,2:11]) + w[1])
}


for(n in seq(1,1000)) {
  if((prediction[n]<0.5 && smaller_sample$lrscale[n]<0.5) || (prediction[n]>0.5 && smaller_sample$lrscale[n]>0.5)) {
    correct = correct + 1
  }
  else if((prediction[n]<0.5 && smaller_sample$lrscale[n]>0.5) || (prediction[n]>0.5 && smaller_sample$lrscale[n]<0.5)) {
    wrong = wrong + 1
  }
  error = error + abs(prediction[n] - smaller_sample$lrscale[n])
}
error / 1000
correct
wrong
```

